<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>LLM PatentPete Documentation Group 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="documentation_files/libs/clipboard/clipboard.min.js"></script>
<script src="documentation_files/libs/quarto-html/quarto.js"></script>
<script src="documentation_files/libs/quarto-html/popper.min.js"></script>
<script src="documentation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="documentation_files/libs/quarto-html/anchor.min.js"></script>
<link href="documentation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="documentation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="documentation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="documentation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="documentation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#documentation" id="toc-documentation" class="nav-link active" data-scroll-target="#documentation">Documentation</a>
  <ul class="collapse">
  <li><a href="#disclaimer" id="toc-disclaimer" class="nav-link" data-scroll-target="#disclaimer">Disclaimer</a></li>
  <li><a href="#concept" id="toc-concept" class="nav-link" data-scroll-target="#concept">1. Concept</a>
  <ul class="collapse">
  <li><a href="#introduction-to-patent-pete" id="toc-introduction-to-patent-pete" class="nav-link" data-scroll-target="#introduction-to-patent-pete">1.1 Introduction to Patent Pete</a></li>
  <li><a href="#concept-overview" id="toc-concept-overview" class="nav-link" data-scroll-target="#concept-overview">1.2 Concept Overview</a></li>
  <li><a href="#concept-of-patent-classifications" id="toc-concept-of-patent-classifications" class="nav-link" data-scroll-target="#concept-of-patent-classifications">1.3 Concept of Patent Classifications</a></li>
  <li><a href="#how-it-works" id="toc-how-it-works" class="nav-link" data-scroll-target="#how-it-works">1.4 How It Works</a></li>
  <li><a href="#goals" id="toc-goals" class="nav-link" data-scroll-target="#goals">1.5 Goals</a></li>
  </ul></li>
  <li><a href="#user-interface" id="toc-user-interface" class="nav-link" data-scroll-target="#user-interface">2. User Interface</a></li>
  <li><a href="#development" id="toc-development" class="nav-link" data-scroll-target="#development">3. Development</a>
  <ul class="collapse">
  <li><a href="#basics" id="toc-basics" class="nav-link" data-scroll-target="#basics">3.1 Basics</a></li>
  <li><a href="#generating-key-words-and-classifications" id="toc-generating-key-words-and-classifications" class="nav-link" data-scroll-target="#generating-key-words-and-classifications">3.2 Generating Key Words and Classifications</a></li>
  <li><a href="#google-patents-api" id="toc-google-patents-api" class="nav-link" data-scroll-target="#google-patents-api">3.3 Google Patents API</a></li>
  <li><a href="#abstract-extraction" id="toc-abstract-extraction" class="nav-link" data-scroll-target="#abstract-extraction">3.4 Abstract Extraction</a></li>
  <li><a href="#vector-database" id="toc-vector-database" class="nav-link" data-scroll-target="#vector-database">3.5 Vector Database</a></li>
  <li><a href="#webscraping" id="toc-webscraping" class="nav-link" data-scroll-target="#webscraping">3.6 webscraping</a></li>
  <li><a href="#data-structure" id="toc-data-structure" class="nav-link" data-scroll-target="#data-structure">3.7 Data Structure</a></li>
  </ul></li>
  <li><a href="#evaluation" id="toc-evaluation" class="nav-link" data-scroll-target="#evaluation">4. Evaluation</a>
  <ul class="collapse">
  <li><a href="#evaluation-1" id="toc-evaluation-1" class="nav-link" data-scroll-target="#evaluation-1">4.1 Evaluation</a></li>
  </ul></li>
  <li><a href="#issues" id="toc-issues" class="nav-link" data-scroll-target="#issues">5. Issues</a>
  <ul class="collapse">
  <li><a href="#abstracts-in-other-languages-or-fonts" id="toc-abstracts-in-other-languages-or-fonts" class="nav-link" data-scroll-target="#abstracts-in-other-languages-or-fonts">5.1 Abstracts in other Languages or Fonts</a></li>
  <li><a href="#extract-abstracts-from-pdfs" id="toc-extract-abstracts-from-pdfs" class="nav-link" data-scroll-target="#extract-abstracts-from-pdfs">5.2 Extract Abstracts from PDFs</a></li>
  <li><a href="#abstracts-not-always-found-on-the-first-page-of-patents" id="toc-abstracts-not-always-found-on-the-first-page-of-patents" class="nav-link" data-scroll-target="#abstracts-not-always-found-on-the-first-page-of-patents">5.3 Abstracts Not Always Found on the First Page of Patents</a></li>
  <li><a href="#not-maschine-readable" id="toc-not-maschine-readable" class="nav-link" data-scroll-target="#not-maschine-readable">5.4 Not Maschine-Readable</a></li>
  </ul></li>
  <li><a href="#further-possible-improvements" id="toc-further-possible-improvements" class="nav-link" data-scroll-target="#further-possible-improvements">6. Further Possible Improvements</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">LLM PatentPete Documentation Group 2</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="documentation" class="level1">
<h1>Documentation</h1>
<section id="disclaimer" class="level2">
<h2 class="anchored" data-anchor-id="disclaimer">Disclaimer</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>To be able to start the application without errors, you need to update your .env please, with the following attributes:</p>
<ul>
<li><p><code>OPENAI_API_KEY = 'OWN SECRET KEY'</code></p></li>
<li><p><code>GOOGLE_PATENT_API_KEY = '7661f86900cb42b2782c2af5c95142574b959dd5546c98491652475ea91e278e'</code></p></li>
<li><p><code>DATABASE_URI = 'mongodb+srv://timmey:faB8MFdyyb7zWvVr@llm-ttt.8kqrnka.mongodb.net/?retryWrites=true&amp;w=majority'</code></p></li>
</ul>
</div>
</div>
</section>
<section id="concept" class="level2">
<h2 class="anchored" data-anchor-id="concept">1. Concept</h2>
<section id="introduction-to-patent-pete" class="level3">
<h3 class="anchored" data-anchor-id="introduction-to-patent-pete">1.1 Introduction to Patent Pete</h3>
<p>Patent research can be a critical and time-consuming process for inventors, researchers, and patent professionals. It involves not only identifying relevant patents, but also understanding the intricate connections and similarities between them. Patent Pete is designed to address these challenges by leveraging advanced technology to make patent research more accessible, efficient, and insightful.&nbsp;</p>
<p>Patent Pete automates the search and analysis process for patent discovery, making it ideal for inventors, research and development teams, patent professionals, and academics. It helps identify relevant patents, avoid infringement, guide innovation, conduct prior art searches, and explore technological trends. Patent Pete is an essential tool for anyone involved in patent research or development.</p>
</section>
<section id="concept-overview" class="level3">
<h3 class="anchored" data-anchor-id="concept-overview">1.2 Concept Overview</h3>
<p>Patent Pete is based on a Retrievable Augmented Generation (RAG) model. It integrates OpenAI’s large language model capabilities with advanced search and similarity comparison techniques. This application simplifies patent research by allowing users to enter a patent document. It then conducts a thorough search for related patents and provides the user the links to them for further research.&nbsp;</p>
</section>
<section id="concept-of-patent-classifications" class="level3">
<h3 class="anchored" data-anchor-id="concept-of-patent-classifications">1.3 Concept of Patent Classifications</h3>
<p>Patent classifications are used to organize patents into categories to make them easier to search, compare and understand. They enable patent offices, inventors, companies and researchers to find relevant patents and obtain information about the state of the art in specific fields. Here are some reasons why patent classifications are important:</p>
<p><strong>Organization and structuring:</strong> With thousands of patents filed every year, patent classifications help to create order and divide patents into logical categories.</p>
<p><strong>Searching and monitoring:</strong> Classification allows inventors and companies to monitor patents in areas relevant to their work and identify new developments.</p>
<p><strong>Avoid duplicates:</strong> Classifications help patent examiners to identify similar inventions and avoid duplication of work.</p>
<p><strong>International harmonization:</strong> Patent classification systems allow different countries to harmonize their patent data internationally, facilitating collaboration and information exchange.</p>
<p>There are various patent classification systems that have been developed by different countries and organizations. The best known are:</p>
<div>
<ul>
<li><p>The International Patent Classification (IPC): This was developed by the World Intellectual Property Organization (WIPO) and is used by most countries in the world. The IPC categorizes inventions into thematic groups and subclasses according to technical characteristics. It is very simple to use and easy to see how it works, as shown in <a href="#fig-ipc">Figure&nbsp;1</a>.</p></li>
<li><p>Common Patent Classification (CPC): A common classification system developed by the patent offices of the United States (USPTO) and Europe (EPO). The CPC is based on the IPC, but has been adapted to the needs of the USA and Europe.</p></li>
<li><p>US Patent Classification (USPC): The classification system used in the United States that categorizes patents into different classes.</p></li>
</ul>
</div>
<div id="fig-ipc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/IPC-class-hierarchy.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: IPC Classification Hierarchy</figcaption>
</figure>
</div>
</section>
<section id="how-it-works" class="level3">
<h3 class="anchored" data-anchor-id="how-it-works">1.4 How It Works</h3>
<p>The user submits a patent document to Patent Pete to begin the process. Patent Pete employs a language model to analyze the abstract and generate relevant keywords and patent classifications. These elements form the basis for a targeted search in the Google Patents database, ensuring the relevance of the results for the user’s initial query.</p>
<p>After retrieving potential matches, Patent Pete continues the search. It enhances search results by embedding them into a vector database. This enables a similarity search that pinpoints the top 10 results based on their relevance and likeness to the submitted abstract. The top contenders undergo a second similarity comparison by the LLM, ensuring thorough evaluation of each patent’s nuances and specificities.</p>
<p>Patent Pete presents the user with the five best matching patents. These patents are the most relevant and similar to the user’s initial submission, making the research process efficient and effective.</p>
</section>
<section id="goals" class="level3">
<h3 class="anchored" data-anchor-id="goals">1.5 Goals</h3>
<p>The goal of Patent Pete is not to replace traditional patent research methods completely but to provide users with a more accessible and efficient starting point for their patent exploration journey and saving them a lot of time. By automating the initial stages of research and analysis, Patent Pete aims to streamline the process, allowing users to quickly identify relevant patents and focus their efforts on deeper investigation where human expertise and judgment are irreplaceable.</p>
</section>
</section>
<section id="user-interface" class="level2">
<h2 class="anchored" data-anchor-id="user-interface">2. User Interface</h2>
<p>At the beginning, we decided to create our user interface with the streamlit framework. After some research and a recommendation from our lecturer, we switched to Gradio, as this framework is designed more for AI-based apps.&nbsp;&nbsp;</p>
<p>The user interface was originally only supposed to consist of an input and output field. The input field was a text field in which the patent idea could be entered or the abstract copied in. After receiving feedback from our project partner, we decided to implement an upload field instead to make the input more user-friendly and enable greater accessibility during use.&nbsp;&nbsp;</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading PDF file from user input and extracting first page containing the abstract</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> input_analysis(<span class="bu">file</span>, progress<span class="op">=</span>gr.Progress()):</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">file</span> <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Reading PDF file</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        progress(<span class="fl">0.2</span>, desc<span class="op">=</span><span class="st">"Processing file"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        pdf_reader <span class="op">=</span> PyPDF2.PdfReader(<span class="bu">file</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting content</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> pdf_reader.pages[<span class="dv">0</span>].extract_text()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> gr.Error(<span class="st">"The file seems to be invalid. Please check your file or </span><span class="ch">\</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="st">                try another Pdf!"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        progress(<span class="fl">0.3</span>, desc<span class="op">=</span><span class="st">"Analyzing file"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>files<span class="op">=</span> gr.File(file_types<span class="op">=</span>[<span class="st">'.pdf'</span>], label<span class="op">=</span><span class="st">"Upload your pdf here."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output field should contain the result of the research, including the necessary information about the patents, the user needs. First, we decided to give out the matching score of each patent with the input and the link to related PDF. Realizing, that the score would be irrelevant for the user or even confuse them, we changed the results. Now the result contains the title, the PDF link and number of the position of the ranking. Temporary, we faced the problem, that the result was correctly formatted.&nbsp;&nbsp;&nbsp;</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatting final scoring results for user output</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>final_scoring_formatted <span class="op">=</span> <span class="st">"Ergebnis:</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>counter<span class="op">=</span><span class="dv">1</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patent_id <span class="kw">in</span> final_scoring_patent_ids:</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    final_scoring_formatted <span class="op">+=</span> <span class="st">"#"</span> <span class="op">+</span> <span class="bu">str</span>(counter) <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> patent_data[patent_id][<span class="st">"title"</span>] </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"https://patentimages.storage.googleapis.com/"</span> <span class="op">+</span> patent_data[patent_id][<span class="st">"pdf"</span>] </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    counter<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> final_scoring_formatted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#New Value "Top 5 PDFs ...."</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>endresult <span class="op">=</span> gr.Textbox(label<span class="op">=</span><span class="st">"End Result"</span>, value<span class="op">=</span><span class="st">"None"</span>, show_copy_button<span class="op">=</span><span class="va">True</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In addition, we added a field for possible configurations for the patent search below the upload field. These should make it possible to select search elements such as classification type, number of keywords/classifications or the database to be used as desired. However, the options to choose another patent database or another type of classification only serves as a mockup in our final application. We just wanted to show which more possibilities the application could have.&nbsp;&nbsp;</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gradio interface for our configurations</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> gr.Column() <span class="im">as</span> main:</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    gr.Markdown(<span class="st">"&lt;p&gt;&lt;h2 style='color:#2563EB'&gt;Input&lt;/h2&gt;&lt;/p&gt;"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    files<span class="op">=</span> gr.File(file_types<span class="op">=</span>[<span class="st">'.pdf'</span>], label<span class="op">=</span><span class="st">"Upload your pdf here."</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    gr.Markdown(<span class="st">"&lt;u&gt;Configuration Options&lt;/u&gt;"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    gr.Radio([<span class="st">"International Patent Classification (IPC)"</span>, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"United States Patent and Trademark Office (USPTO)"</span>, <span class="st">"Cooperative Patent Classification (CPC)"</span>, </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Deutsche Klassifizierung (DEKLA)"</span>], label<span class="op">=</span><span class="st">"Type of Classification"</span>, </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    value<span class="op">=</span><span class="st">"Cooperative Patent Classification (CPC)"</span>),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    slide_keywords <span class="op">=</span> gr.Slider(<span class="dv">1</span>, <span class="dv">5</span>, step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Number of Key Words"</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    slide_classes <span class="op">=</span> gr.Slider(<span class="dv">1</span>, <span class="dv">5</span>, step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Number of Classifications"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    gr.CheckboxGroup([<span class="st">"Google Patents"</span>, <span class="st">"Espacenet"</span>, <span class="st">"European Patent Office (EPO)"</span>, <span class="st">"DEPATISnet"</span>], </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"Databases"</span>, info<span class="op">=</span><span class="st">"Which databases should be searched?"</span>, value<span class="op">=</span><span class="st">"Google Patents"</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    button <span class="op">=</span> gr.Button(<span class="st">"Submit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>During development, we have built in a detailed output to be able to call up the respective steps of the program. This was to indicate, for example, whether a retrieval with Google Patents or a connection to the vector database had taken place. However, this greatly disfigured the UI, and we decided to put the details in a pop-up window. Ultimately, we came to the realization that this information was trivial for the user and removed it completely.&nbsp;</p>
<p>As a bonus, we wanted to integrate a button with which the results can be formatted and downloaded in a PDF. However, we were confronted with some technical problems, particularly the transfer of the results to the PDF, so that it did not make it into the final version due to time constraints. As an alternative, we have implemented a copy button in the output window so that the results can at least be copied.&nbsp;</p>
</section>
<section id="development" class="level2">
<h2 class="anchored" data-anchor-id="development">3. Development</h2>
<section id="basics" class="level3">
<h3 class="anchored" data-anchor-id="basics">3.1 Basics</h3>
<p>To realize our previous plans, we took various steps during our project. Firstly, we devised a series of sample patents and generated corresponding abstracts. The aim was to obtain a wide variety of abstracts to enable a comprehensive analysis. These abstracts were carefully formulated and saved as PDFs.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading PDF file from user input and extracting first page containing the abstract</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> input_analysis(<span class="bu">file</span>, progress<span class="op">=</span>gr.Progress()):</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">file</span> <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Reading PDF file</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        progress(<span class="fl">0.2</span>, desc<span class="op">=</span><span class="st">"Processing file"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        pdf_reader <span class="op">=</span> PyPDF2.PdfReader(<span class="bu">file</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting content</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> pdf_reader.pages[<span class="dv">0</span>].extract_text()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> content <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> gr.Error(<span class="st">"The file seems to be invalid. Please check your file or try another Pdf!"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        progress(<span class="fl">0.3</span>, desc<span class="op">=</span><span class="st">"Analyzing file"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generating-key-words-and-classifications" class="level3">
<h3 class="anchored" data-anchor-id="generating-key-words-and-classifications">3.2 Generating Key Words and Classifications</h3>
<p>In the planning phase, we focussed on developing efficient LLM prompts to generate keywords and classifications based on the sample abstracts. For this purpose, we created various sample abstracts and recorded them in an Excel spreadsheet. By defining and evaluating different prompts, we were able to select the one that provided the most search results to enable a comprehensive search.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LLM Prompt generating Key Words on base of the PDF Input from User</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> output_keywords(content, n, progress<span class="op">=</span>gr.Progress()):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    progress(<span class="dv">0</span>, desc<span class="op">=</span><span class="st">"Generating Key Words..."</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    keyword_prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ss">    The following abstract descripes a concept for a novel invention:</span><span class="ch">\</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ss">    ```</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">```</span><span class="ch">\</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    Name </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss"> key words based on this abstract, that I can use for the search in a patent database. </span><span class="ch">\</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    Optimize the key words to get back more results. Result as python string.</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    response_keywords <span class="op">=</span> get_completion(keyword_prompt)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response_keywords</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>During the development of the project, concerns were raised by ZOI about the ability of LLM to correctly generate classifications based on the abstracts. For this reason, we decided to generate five classifications, both as International Patent Classification (IPC) and Cooperative Patent Classification (CPC) as well as in US Patent and Trademark Office (USPTO) classification.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LLM Prompt generating Classifications on base of the PDF Input from User</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> output_classes(content, n, progress<span class="op">=</span>gr.Progress()):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Progress Bar from Gradio to visualize the current progress</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  progress(<span class="dv">0</span>, desc<span class="op">=</span><span class="st">"Generating Classifications..."</span>) </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  classes_prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ss">      The following abstract descripes a concept for a novel invention:</span><span class="ch">\</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ss">      ```</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">```</span><span class="ch">\</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ss">      Name </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss"> CPC classifications based on this abstract, that I can use for  </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ss">      the search in a patent database. </span><span class="ch">\</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="ss">      Please give me a python string for the codes of the </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss"> most relevant </span><span class="ch">\</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ss">      CPC classifications to a possible patent. </span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ss">      """</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  response_classes <span class="op">=</span> get_completion(classes_prompt)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> response_classes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After manually comparing the classifications with the official registers, we found that the LLM coped well with the IPC/CPC classifications in particular. However, we encountered difficulties when it came to the USPTO subclasses. The LLM did not seem to be able to correctly recognize the subtleties of the subclasses and assign them accordingly.</p>
</section>
<section id="google-patents-api" class="level3">
<h3 class="anchored" data-anchor-id="google-patents-api">3.3 Google Patents API</h3>
<p>Choosing the right patent databases proved to be more difficult than originally assumed. There are a variety of patent databases, each serving a specific purpose in the areas of research, innovation and intellectual property protection. These databases play a crucial role in identifying relevant patents, researching prior art and monitoring potential patent infringements.</p>
<p>Access to a comprehensive and up-to-date database is essential for an effective patent search. However, the patent database landscape is fragmented as many databases are operated by official authorities such as the German Patent and Trade Mark Office (DPMA) or the European Patent Organisation (EPO), each with their own API. This fragmentation leads to different logic and a limited amount of data, which makes detailed searches difficult.</p>
<p>When selecting a suitable patent database, we looked at various databases in advance and identified their strengths:</p>
<p><strong>Espacenet:</strong> This database is particularly suitable for “state of the art” searches. It provides access to an extensive collection of patent documents from all over the world and enables users to research the current state of development in various fields of technology.</p>
<p><strong>DPMA Register:</strong> With its register, the German Patent and Trade Mark Office offers a comprehensive database for IP searches and patent monitoring. Here, users can access information on German patents, trade marks and designs and track relevant legal events.</p>
<p><strong>European Patent Register (EPO):</strong> The European Patent Register is a valuable resource for searching for European patents. It provides access to patent documents from various European countries and facilitates the search for European intellectual property rights.</p>
<p><strong>World Intellectual Property Organisation (WIPO):</strong> The WIPO database provides a global overview of international patent information. Users can search for patents from various countries and retrieve information on international property rights.</p>
<p><strong>Octimine:</strong> Octimine provides a complete overview of patent data from the EU, the USA and WIPO. The database enables users to search patents and find relevant information for their research and development projects.</p>
<p><strong>DEPATISnet:</strong> With over 60 million patent documents, DEPATISnet is one of the most comprehensive patent databases in the world. It provides access to a large number of patents from different countries, however some documents may not be translated, which can limit their use.</p>
<p><strong>Google Advanced Patent Search:</strong> Google Advanced Patent Search database provides a good overview of the international patent market. The metadata of the patent information is organised in a structured manner. It is particularly noteworthy that Google Patents utilises current CPC classifications and can therefore provide ideal opportunities for a more targeted overall overview.</p>
<p>Google Patents seemed to us to be the ideal place to start. On the one hand, this database allowed us to partially circumvent the above-mentioned problems of the various authorities and summarize them under a uniform logic. Although Google Patents does not have an official API, we used a third-party provider, SerpAPI, to perform searches. SerpAPI does provide useful data in JSON format, but its free plan limits queries to 100 per month and accommodates up to 1,000 patents with 10 results per query.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initializing base vars for the following loop</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>progress(<span class="fl">0.5</span>, desc<span class="op">=</span><span class="st">"Researching patents"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>patent_api_key <span class="op">=</span> os.environ[<span class="st">'GOOGLE_PATENT_API_KEY'</span>] <span class="co">#load secret key for the google patent api</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>patent_base_url <span class="op">=</span> <span class="st">"https://patentimages.storage.googleapis.com/"</span> <span class="co">#just to complete the url</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>patent_data <span class="op">=</span> {}</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop for multiple Google Patents API calls with Key Words</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> keywords_list:</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    openai_response <span class="op">=</span> i <span class="co">#Search String for Google Patents</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    url_base <span class="op">=</span> <span class="st">"https://serpapi.com/search.html?engine=google_patents"</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> openai_response.replace(<span class="st">" "</span>, <span class="st">"+"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> url_base <span class="op">+</span> <span class="st">"&amp;q="</span> <span class="op">+</span> query <span class="op">+</span> <span class="st">"&amp;language=ENGLISH&amp;api_key="</span> <span class="op">+</span> patent_api_key</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API call Google Patents</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if API call was successful</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> response.json() <span class="co">#write json-answer in var</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> cluster <span class="kw">in</span> data[<span class="st">"results"</span>][<span class="st">"cluster"</span>]:</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> result <span class="kw">in</span> cluster[<span class="st">"result"</span>]:</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                <span class="bu">id</span> <span class="op">=</span> result[<span class="st">"patent"</span>][<span class="st">"publication_number"</span>]</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">id</span> <span class="kw">not</span> <span class="kw">in</span> patent_data.keys():</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                    patent_data[<span class="bu">id</span>] <span class="op">=</span> {</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"pdf"</span>: result[<span class="st">"patent"</span>][<span class="st">"pdf"</span>],</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error with API request: Status code </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Parsing API answer .json and adding the patent ID to the patent_data dict, avoiding duplicates</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster <span class="kw">in</span> data[<span class="st">"results"</span>][<span class="st">"cluster"</span>]:</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> result <span class="kw">in</span> cluster[<span class="st">"result"</span>]:</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        patent_id <span class="op">=</span> result[<span class="st">"patent"</span>][<span class="st">"publication_number"</span>]</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> patent_id <span class="kw">not</span> <span class="kw">in</span> patent_data.keys():</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            patent_data[patent_id] <span class="op">=</span> {</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pdf"</span>: result[<span class="st">"patent"</span>][<span class="st">"pdf"</span>],</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, our reliance on the JSON file from Google Patents API via SerpAPI revealed limitations during LLM-based similarity checks. This JSON file has a character limit for abstracts, omitting claims and descriptions entirely. This constraint stems from SerpAPI’s output mirroring the structure of Google Patents search results, storing only partial abstracts displayed in previews.</p>
<p>To overcome this obstacle, we implemented a web scraping function. This function utilizes patent IDs from SerpAPI’s JSON to sequentially retrieve individual patent pages, enabling us to scrape complete abstracts, descriptions, and claims for thorough analysis.</p>
</section>
<section id="abstract-extraction" class="level3">
<h3 class="anchored" data-anchor-id="abstract-extraction">3.4 Abstract Extraction</h3>
<p>To optimize the extraction of the abstracts from the patents, we decided to save the results in a JSON file. This enabled efficient utilisation of the information and also served as a mini-database replacement. We then developed an LLM prompt to compare the saved abstracts with a sample abstract and output the match percentage. Although this approach was promising, we realised that it was slow due to the large amount of data and exceeded OpenAI’s token limit.</p>
</section>
<section id="vector-database" class="level3">
<h3 class="anchored" data-anchor-id="vector-database">3.5 Vector Database</h3>
<p>After realizing that the previous method of comparing the abstracts to the LLM led to performance issues, we looked closely at alternative solutions. One promising option was the use of vector databases. We carried out extensive research to find the most suitable solution for our project.</p>
<p>Our first approach was to access the DocumentDB via AWS. Unfortunately, this attempt proved unsuccessful, as we encountered unexplained access restrictions that also affected the DocumentDB. This meant that we had to look for another solution to fulfil our requirements.</p>
<p>In the end, we decided on MongoDB ATLAS as an alternative. This service also utilizes the AWS infrastructure, which allowed for seamless integration into our existing setup. We set up a vector database in MongoDB ATLAS and developed an API to access this database.</p>
<p>The use of MongoDB ATLAS proved to be extremely successful. The API enabled us to insert, retrieve and delete new content from the vector database and, most importantly, to efficiently compare the stored abstracts to obtain the desired similarity results. In addition, we were able to successfully solve performance issues that we previously had with the LLM. The results from the vector database were more accurate and reliable than the previously used LLM method.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>database <span class="op">=</span> get_database_connection()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Clearing db before adding new data, to avoid any distortion of results</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>clear_db(database)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ATLAS_VECTOR_SEARCH_INDEX_NAME <span class="op">=</span> <span class="st">"vector_index"</span> <span class="co">#intitalize vector similarity search      </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># insert the documents in MongoDB Atlas with their embedding</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>vector_search <span class="op">=</span> MongoDBAtlasVectorSearch.from_documents(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    documents<span class="op">=</span>patent_list,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    embedding<span class="op">=</span>OpenAIEmbeddings(disallowed_special<span class="op">=</span>()), <span class="co">#use openAI embeddings method</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    collection<span class="op">=</span>database,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    index_name<span class="op">=</span>ATLAS_VECTOR_SEARCH_INDEX_NAME,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># waiting for the db to save</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">5</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing a similarity search with Score between the embedding of the query </span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># and the embeddings of the documents</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>progress(<span class="fl">0.9</span>, desc<span class="op">=</span><span class="st">"Compare the patents"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="bu">str</span>(content)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> vector_search.similarity_search_with_score(</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span>query,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    k<span class="op">=</span><span class="dv">10</span>, <span class="co">#Output for the top 10 results</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By implementing the vector database, further performance optimizations were achieved, as the processing of the extracted abstracts was also improved. The key benefit was that we no longer had to rely on creating and reading the JSON file. Instead, we were able to write the results directly to the vector database. This led to a significant increase in performance, as the data could be accessed faster and more efficiently.</p>
<p>Although we decided to use the vector database as the main method, we still retained the evaluation via the LLM as an additional quality feature. We re-evaluated the best 10 results from the vector database using the LLM method to ensure that the quality of the results continues to meet our standards.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatting vector search result for further usage</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>vector_scoring <span class="op">=</span> {}</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> result <span class="kw">in</span> results:</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    vector_scoring[result[<span class="dv">0</span>].metadata[<span class="st">'patent_id'</span>]] <span class="op">=</span> result[<span class="dv">1</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Building LLM similarity scoring prompt</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>comparison_prompt <span class="op">=</span> <span class="ss">f"""The following texts are abstracts from patent specifications. Your task is </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ss">to compare the "Testing Abstract" to all the others. It is important that you focus on comparing the </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="ss">concepts that the abstracts describe, not the way they are written. Rank the remaining abstracts on </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ss">how well they match with the Testing Abstract by giving them a rating from 0 to 10 points. 0 meaning </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="ss">they have absolutely nothing in common and 10 meaning they basically describe the exact same idea.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="ss">Your output should be a python dictionary with the title "comparison", each element hast the Abstract </span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="ss">number as key and the rating as value. I want to convert your output string to an actual dictionary, </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="ss">so make sure the formatting is right.</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="ss">Testing Abstract: "</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding patent abstracts to the prompt</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patent_id <span class="kw">in</span> vector_scoring.keys():</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if there is an abstract for the patent</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> patent_id <span class="kw">in</span> patent_data <span class="kw">and</span> patent_data[patent_id][<span class="st">"abstract"</span>]:</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        comparison_prompt <span class="op">+=</span> <span class="ss">f'</span><span class="sc">{</span>patent_id<span class="sc">}</span><span class="ss">: "</span><span class="sc">{</span>patent_data[patent_id][<span class="st">"abstract"</span>]<span class="sc">}</span><span class="ss">"</span><span class="ch">\n</span><span class="ss">'</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> get_completion(comparison_prompt)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatting LLM output</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>llm_scoring_raw <span class="op">=</span> <span class="bu">eval</span>(response.replace(<span class="st">"comparison = "</span>,<span class="st">""</span>))</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating final scoring results (combining vector scoring with llm scoring)</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transform_ratings(ratings, new_min<span class="op">=</span><span class="dv">0</span>, new_max<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine the smallest and largest value in the original dictionary</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    old_min, old_max <span class="op">=</span> <span class="bu">min</span>(ratings.values()), <span class="bu">max</span>(ratings.values())</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    transformed_ratings <span class="op">=</span> {}</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key, value <span class="kw">in</span> ratings.items():</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply the transformation with dynamic old and new ranges</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        transformed_value <span class="op">=</span> ((value <span class="op">-</span> old_min) <span class="op">/</span> (old_max <span class="op">-</span> old_min)) <span class="op">*</span> (new_max <span class="op">-</span> new_min) <span class="op">+</span> new_min</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        transformed_ratings[key] <span class="op">=</span> transformed_value</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> transformed_ratings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="webscraping" class="level3">
<h3 class="anchored" data-anchor-id="webscraping">3.6 webscraping</h3>
<p>Although the contents of the API provide initial information on relevant patents, they are not yet detailed enough to make a well-founded statement as to whether a patent is considered to be relevant or not. Important information such as the claims of the patents or the patent text were not included in the search results, and the abstract was often incomplete as it was cut off after a certain point.</p>
<p>Initially, we tried to extract this information from the PDFs of the individual patents. However, we found that this solution not only took an incredibly long time, as a large amount of data had to be loaded, but also delivered rather inaccurate results. The contents of the patent specifications could often not be accurately extracted and were also not always written in English, but rather in Chinese or Korean, which presented a major challenge.</p>
<p>We therefore decided to retrieve the detailed patent data directly from Google Patents via web scraping using BeautifulSoup. This gave us access to the complete title, abstract, the entire patent specification and the claims. This had several advantages: Firstly, we were able to significantly shorten the runtime in that we no longer had to download large amounts of data from PDFs and extract them in a time-consuming step, but were able to process plain text instead. However, what was even more important was that we now had access to patent texts that were translated directly into English by Google, which not only made the following content analysis much easier, but actually made it possible in the first place.</p>
<p>While the scraping of the search results page was blocked by Google after a few requests, we had no problems accessing the individual patent pages directly. This allowed us to integrate this solution into our final application.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scraping complete patent data (title, abstract, description, claims)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>progress(<span class="fl">0.6</span>, desc<span class="op">=</span><span class="st">"Collecting patent data"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patent_id <span class="kw">in</span> patent_data.keys():</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generating Google Patent links for each ID</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://patents.google.com/patent/"</span> <span class="op">+</span> patent_id <span class="op">+</span> <span class="st">"/en"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    html_content <span class="op">=</span> response.content</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> bs(html_content, <span class="st">'html.parser'</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scraping Title</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    title_span <span class="op">=</span> soup.find(<span class="st">'span'</span>, itemprop<span class="op">=</span><span class="st">'title'</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> title_span <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> title_span.get_text()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Removing weird ending of title</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        to_remove <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> title.replace(to_remove, <span class="st">""</span>).strip()</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="va">False</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scraping Abstract</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    abstract_div <span class="op">=</span> soup.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'abstract'</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> abstract_div <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        abstract <span class="op">=</span> abstract_div.get_text()</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        abstract <span class="op">=</span> <span class="va">False</span> </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scraping Description</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    description_section <span class="op">=</span> soup.find(<span class="st">'section'</span>, itemprop<span class="op">=</span><span class="st">'description'</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> description_section:</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Removing H2 from section</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        h2_tag <span class="op">=</span> description_section.find(<span class="st">'h2'</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> h2_tag:</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>            h2_tag.decompose()</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Removing all 'notranslate' class items</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> notranslate_tag <span class="kw">in</span> description_section.find_all(class_<span class="op">=</span><span class="st">'notranslate'</span>):</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>            notranslate_tag.decompose()</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Removing all &lt;aside&gt; elements</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> aside_tag <span class="kw">in</span> description_section.find_all(<span class="st">'aside'</span>):</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>            aside_tag.decompose()</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting and joining the text</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>        description <span class="op">=</span> <span class="st">""</span>.join(description_section.stripped_strings)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> description <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>            description <span class="op">=</span> <span class="va">False</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>        description <span class="op">=</span> <span class="va">False</span>   </span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scraping Claims</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    description_section <span class="op">=</span> soup.find(<span class="st">'section'</span>, itemprop<span class="op">=</span><span class="st">'claims'</span>)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> description_section:</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Removing H2 from section</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>        h2_tag <span class="op">=</span> description_section.find(<span class="st">'h2'</span>)</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> h2_tag:</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>            h2_tag.decompose()</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Removing all 'notranslate' class items</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> notranslate_tag <span class="kw">in</span> description_section.find_all(class_<span class="op">=</span><span class="st">'notranslate'</span>):</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>            notranslate_tag.decompose()</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Removing all &lt;aside&gt; elements</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> aside_tag <span class="kw">in</span> description_section.find_all(<span class="st">'aside'</span>):</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>            aside_tag.decompose()</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting and joining the text</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>        claims <span class="op">=</span> <span class="st">""</span>.join(description_section.stripped_strings)</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> claims <span class="op">==</span> <span class="st">""</span>:</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>            claims <span class="op">=</span> <span class="va">False</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>        claims <span class="op">=</span> <span class="va">False</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adding scraped content do patent_data dict</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>    patent_data[patent_id].update({</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">"title"</span>: title,</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">"abstract"</span>: abstract,</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">"description"</span>: description,</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">"claims"</span>: claims</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Another problem that could be solved with this is the long runtime in the step before we load the patents into the vector database. The original plan was to directly open and read in the patent PDFs so that the similarity search in the patent database would be based on as much information as possible. Thanks to the extensive web scraping of the patents, we were able to simply use this data for embedding in the vector database and thus avoid the time-consuming reading of the PDFs.</p>
</section>
<section id="data-structure" class="level3">
<h3 class="anchored" data-anchor-id="data-structure">3.7 Data Structure</h3>
<p>With the implementation of our web scraping feature, we’ve also established a more efficient and organized framework for handling patent information, significantly enhancing our internal data management system. Previously, we had relied on the incomplete JSON of the API, while the PDF content was processed separately and not linked to the original data. This meant that if we needed to reuse an abstract, for example, we would have needed to redo the time-consuming process of reloading and re-scanning the corresponding PDF document. This procedure was far from ideal, especially from a performance point of view, as it would have led to unnecessary delays.</p>
<p>Therefore, we’ve transitioned to a new, more practical data structure. It uses a dictionary in which a new entry is created for each patent ID. Within each of these entries, we store key elements of the patent information, including the title, abstract, full text of the patent, claims, and a direct link to the PDF document.</p>
<p>This enables us to retrieve required patent information quickly and easily at various points in the code as often as needed. In addition, by implementing a system where new patents are only scraped and added if their patent ID does not already exist in the dictionary, we eliminate the risk of duplicating entries. This not only ensures the quality and reliability of our data but also optimizes our storage and processing resources.</p>
</section>
</section>
<section id="evaluation" class="level2">
<h2 class="anchored" data-anchor-id="evaluation">4. Evaluation</h2>
<section id="evaluation-1" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-1">4.1 Evaluation</h3>
<p>When choosing between LlamaIndex and TruLens, we decided in favour of TruLens. This framework offers a wide range of methods that seemed optimal for our use case in order to evaluate and improve the performance of our application. The following methods were considered:</p>
<p><strong>Model Selection:</strong> With this method, TruLens selects the most powerful and efficient model for our application. By comparing different models, we can identify those that deliver the best results and best fulfil our requirements.</p>
<p><strong>Detect and Mitigate Hallucination:</strong> The RAG Triad is used to ensure that our LLM only reacts to the information that comes from the uploaded abstract. This is to ensure that the model does not tend to generate false or misleading information.</p>
<p><strong>Improve Retrieval Quality:</strong> The aim of this method is to improve the quality of information retrieval for our RAG. Through measurement and analysis, we identify opportunities to improve information retrieval and ensure that our results are accurate and relevant. The aim of this method is to see any hallucinations.</p>
<p><strong>Verify the Summarisation Quality:</strong> This checks that the abstracts generated by the LLM contain the key points of the uploaded abstract. The idea behind this was to ensure the quality of the key words and, if applicable, the classifications.</p>
<p><strong>Embeddings Distance:</strong> This method measures the similarity or dissimilarity of texts by representing them as points in a mathematical space. The most common measurement methods for this are: Cosine distance, Manhattan distance and Euclidean distance. The aim was to evaluate and assess the quality of the results of the similarity search that were output by the vector database at the end.</p>
<p>Due to time constraints, only the retrieval quality method was used as seen in <a href="#fig-results">Figure&nbsp;2</a>. Five sample patents were generated and run through the system with their respective abstracts in order to obtain meaningful results at the end.</p>
<p>Although only one evaluation method was implemented, it still provides valuable insights into the performance of the system and its results can already be used as a starting point for future developments and improvements.</p>
<div id="fig-results" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/rag_results.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: RAG Results</figcaption>
</figure>
</div>
<p>Using the retrieval quality method, we evaluated three points in our app:</p>
<div>
<ol type="1">
<li><p>Generation of classifications based on the abstract uploaded by the user</p></li>
<li><p>Generation of key words based on the abstract uploaded by the user</p></li>
<li><p>The LLM evaluation of five randomly generated abstracts based on the abstract uploaded by the user</p></li>
</ol>
</div>
<p>The evluation showed different results. Regarding the generation of classifications, as can be seen in <a href="#fig-classifications">Figure&nbsp;3</a>, there was a low score in terms of groundness, suggesting that the evaluation method assumes that the LLM had difficulties in providing sound classifications and may be hallucinating. However, as mentioned at the beginning of this documentation (see chapter Basics), the group had already checked the classifications manually in advance against the official register and found them to be correct. This indicates that the quality of the classifications is indeed acceptable despite the low rating.</p>
<div id="fig-classifications" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/patent-pete-hallucination-classification.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3: RAG Details Classifications</figcaption>
</figure>
</div>
<p>The results of the key word generation were satisfactory. In the detailed view in <a href="#fig-keywords">Figure&nbsp;4</a>, it can be seen that the RAG does not consistently score 100% for Context Relevance. This could be due to the fact that the LLM has problems prioritising the most important key words in view of the abundance of abstracts. Overall, however, the result is satisfactory.</p>
<div id="fig-keywords" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/patent-pete-hallucination-keywords.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;4: RAG Details Key Words</figcaption>
</figure>
</div>
<p>In contrast, the patent comparison method produced unfavourable results. The low scores suggest that the LLM may not have adequately captured the context of the original abstract and therefore does not provide accurate answers. This suggests that although the LLM evaluation can be considered helpful, it should be used with caution as it may not have the desired reliability. However, it should also be noted, as can be seen in <a href="#fig-comparison">Figure&nbsp;5</a>, that there was only one outlier that negatively affected the values.</p>
<div id="fig-comparison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/patent-pete-hallucination-comparison.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;5: RAG Details Comparison</figcaption>
</figure>
</div>
<p>These results highlight the importance of carefully analysing and interpreting the evaluation results. Although the automated evaluation methods can provide insights, it is important to critically scrutinise them and perform manual checks where necessary to validate the quality of the results and ensure that the system meets the requirements and expectations.</p>
</section>
</section>
<section id="issues" class="level2">
<h2 class="anchored" data-anchor-id="issues">5. Issues</h2>
<section id="abstracts-in-other-languages-or-fonts" class="level3">
<h3 class="anchored" data-anchor-id="abstracts-in-other-languages-or-fonts">5.1 Abstracts in other Languages or Fonts</h3>
<p>When developing the application, we focused on analyzing English-language abstracts and patents. In principle, OpenAi has no problems automatically translating and analyzing texts with Latin fonts in our application. German and French patents could therefore be translated relatively easily. Nevertheless, it can be assumed that there may be translation problems with some patents, especially those in Slavic or other.</p>
<p>In addition, after several test runs with different patents, we found that texts with other fonts, including Chinese and Cyrillic, could not be extracted correctly, and therefore no abstract was available, which led to collapses during the process run. Especially the Arabic font can confuse the LLM, since it also contains a few English words in Latin font. In this case it only took the English words to generate keywords and classifications, so that in the end the quality of these has been too bad, to get a proper output of similar patents.</p>
<p>We tried to minimize these issues by implementing an examination, which checks, if there has been extracted, an abstract or text. On this way, it was possible to pretend to get no abstract. Nevertheless, the problem of the translation or text structure could still come up, when the abstract is extracted and analyzed.</p>
</section>
<section id="extract-abstracts-from-pdfs" class="level3">
<h3 class="anchored" data-anchor-id="extract-abstracts-from-pdfs">5.2 Extract Abstracts from PDFs</h3>
<p>When extracting the abstracts from the results of the Google Patent API, we encountered various problems that we had to solve during the project. Normally PDFs are formatted the way you can see in <a href="#fig-correct">Figure&nbsp;6</a>.</p>
<div id="fig-correct" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/marked_pdf_correct.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Correct formatted PDF</figcaption>
</figure>
</div>
<p>But a particularly common problem was that about one in ten PDFs was not formatted correctly in a machine-readable way: In some cases, it may be difficult for text extraction tools to recognize and select the text properly because of the structure of the PDF itself. This can happen if the PDF is poorly formatted or if the text is embedded in a way that makes it difficult to separate from other elements on the page.</p>
<p>This can be seen in <a href="#fig-incorrect">Figure&nbsp;7</a> if you simply try to select the corresponding text block of the abstract with the mouse courser in order to copy it, for example. The cursor jumpes to the left column of the page after the first line of the abstract, which led to a jumble of the read string. <a href="https://patentimages.storage.googleapis.com/a6/11/c7/5583de7c8fb29d/US9060688.pdf">Here is an example of an incorrect formatted patent abstract.</a> To solve this problem, the LLM was used again to reconstruct the text and remove interfering or incorrect words. The text was then copied manually from the PDF and compared with the reconstructed text using the Levenshtein method. Agreements of regularly over 95% confirmed the accuracy of the LLM reconstruction.</p>
<div id="fig-incorrect" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/marked_pdf_incorrect.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Incorrect formatted PDF</figcaption>
</figure>
</div>
</section>
<section id="abstracts-not-always-found-on-the-first-page-of-patents" class="level3">
<h3 class="anchored" data-anchor-id="abstracts-not-always-found-on-the-first-page-of-patents">5.3 Abstracts Not Always Found on the First Page of Patents</h3>
<p>In order to reduce processing time and optimise the performance of our system, we decided to only scan the first page of each PDF. This decision was based on the fact that the abstract is typically found on the first page. By only analysing this first page, we were able to reduce the workload and increase efficiency.</p>
<p>However, we found that in about one in fifty PDFs, the abstract was not positioned on the first page as expected. Instead, it was randomly located on later pages, such as the fifth or even thirteenth page. This posed a challenge, as our assumption that the abstract should always be on the first page proved to be insufficient. However, since this problem was rare and our time was limited, we decided to put it on the back burner for the time being and focus on more pressing issues. Our priority was to ensure the main functionality of our system and to make sure that it worked flawlessly and efficiently. Unfortunately, in the end there was not enough time to solve this specific problem.</p>
</section>
<section id="not-maschine-readable" class="level3">
<h3 class="anchored" data-anchor-id="not-maschine-readable">5.4 Not Maschine-Readable</h3>
<p>Furthermore, about every fiftieth PDF was also not machine-readable. There are several reasons why some PDFs may not be selectable, meaning that the text cannot be easily copied or extracted from the document:</p>
<p><strong>Scanned documents:</strong> When a PDF is created from scanned images rather than digital text, the text in the document is essentially an image and is not selectable. This is because the text is not recognized by the computer as text, but as pixels forming an image.</p>
<p><strong>Document security:</strong> Some PDF files are created with security settings that prevent text from being extracted or copied. This is often done to protect sensitive information in the document. Text encoding: If the text in the PDF is encoded in a way that is not compatible with text extraction tools, it may not be selectable. This can happen with certain fonts or character encodings that are not recognized by the software trying to extract the text.</p>
<p>We were unable to solve this problem and find a solution due to lack of time constraints.</p>
</section>
</section>
<section id="further-possible-improvements" class="level2">
<h2 class="anchored" data-anchor-id="further-possible-improvements">6. Further Possible Improvements</h2>
<p>We concluded that the application still needs a few improvements. First and foremost is the performance. Basically, if you look at the output of the results via the application in relation to the general patent search, you can see a drastic improvement in the duration of the search. While a classic patent search can take several hours or even days, the application outputs the results within 2 minutes. Nevertheless, some performance improvements could be made to provide a better user experience.</p>
<p>For example, the prompts could be improved, especially the prompt for the classifications, which, as explained above, did not perform well in the evaluation. Giving some examples or a more detailed explanation could result in better performance. It would also be possible to combine the prompts for the keywords and the classifications into one prompt. Another improvement for the performance would be to collect the patents via other API providers or databases. Improvements can also be made in the content analysis of patents. An extended analysis of the patents based on the metadata (year of publication, period of validity, place of publication, etc.) or more configurations for the patent research could make the analysis more detailed and thus make it easier to check whether there is a match.</p>
<p>We also would intend to use another framework for our UI, since a good tool to encode a basic Interface for applications with AI, but it’s not good for customize the website and creating a user-friendly interface.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>